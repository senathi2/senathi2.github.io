<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Olympic Medals Visualization</title>
  <!-- Load d3.js -->
  <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>

  <!-- A bit of CSS: change stroke color of circle on hover (white -> black) -->
  <style>
    .btn {
      border: none;
      background-color: inherit;
      padding: 5px 5px;
      font-size: 15px;
      cursor: pointer;
      display: inline-block;
    }

    /* On mouse-over */
    .btn:hover {
      background: #eee;
    }
  </style>
</head>

<body>

  <!-- Create a div where the graph will take place -->
  <div>
    <button id="btnPrev" class="btn" onclick="updateViz(-1)">Prev</button>
    <button id="btnNext" class="btn" onclick="updateViz(1)">Next</button>
    &nbsp; &nbsp;
    <b><label id="city_year"></label></b>
  </div>
  <div id="my_dataviz"></div>

  <script type="text/javascript">
    var currYear = null;
    /*var fulldata;
    d3.csv("https://github.com/senathi2/senathi2.github.io/blob/master/OlympicsMedalData.csv", function (data) {
		fulldata=data;
        console.log(data);
      });*/

    function updateViz(yearDirection) {
      render_viz(prepData(currYear + 4 * yearDirection));
    }

    function prepData(year) {
	var currCity = null; 
      // Test dataset
      // Comment when using real data loaded through d3.csv function
     /*dataset = null; {
        "children": [{ "Name": "United States", "Gold": 46, "Silver": 37, "Bronze": 38 },
        { "Name": "China", "Gold": 26, "Silver": 18, "Bronze": 26 },
        { "Name": "Russia", "Gold": 19, "Silver": 18, "Bronze": 19 },
        { "Name": "Britain", "Gold": 27, "Silver": 23, "Bronze": 17 },
        { "Name": "France", "Gold": 10, "Silver": 18, "Bronze": 14 },
        { "Name": "Italy", "Gold": 8, "Silver": 12, "Bronze": 8 },
        { "Name": "Mexico", "Gold": 0, "Silver": 3, "Bronze": 2 },
        { "Name": "Japan", "Gold": 12, "Silver": 8, "Bronze": 21 },
        { "Name": "Brazil", "Gold": 7, "Silver": 6, "Bronze": 6 }]
      };	*/     
	dataset = {
    			"children": []
		};     
	  
	d3.csv("https://senathi2.github.io/OlympicsMedalData.csv", function(data) {
	     //console.log(data);
		for (var i = 0; i < data.length; i++) {
			if(data[i].Year == year) {
				dataset.children.push({ 
        					"Name": data[i].Country,
        					"Gold": parseInt(data[i].Gold, 10),
        					"Silver": parseInt(data[i].Silver, 10),
						"Bronze": parseInt(data[i].Bronze, 10)
    					});
				currCity = data[i].City;
			}
		}
  	


      //currCity = "Rio";
      currYear = year;
      if (currYear == 2016) {
        document.getElementById("btnNext").disabled = true;
      }
      else {
        document.getElementById("btnNext").disabled = false;
      }
      if (currYear == 1896) {
        document.getElementById("btnPrev").disabled = true;
      }
      else {
        document.getElementById("btnPrev").disabled = false;
      }
      document.getElementById("city_year").innerHTML = currCity + "&nbsp;" + currYear;
      //return dataset;
	render_viz(dataset);
	});
    }

    function render_viz(dataset) {
      var diameter = 600;
      var color = d3.scaleOrdinal(d3.schemeCategory20);

      var bubble = d3.pack(dataset)
        .size([diameter, diameter])
        .padding(1.5);

      document.getElementById("my_dataviz").innerHTML = "";

      var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", diameter)
        .attr("height", diameter)
        .attr("class", "bubble");

      var nodes = d3.hierarchy(dataset)
        .sum(function (d) { return d.Gold + d.Silver + d.Bronze; });

      var node = svg.selectAll(".node")
        .data(bubble(nodes).descendants())
        .enter()
        .filter(function (d) {
          return !d.children
        })
        .append("g")
        .attr("class", "node")
        .attr("transform", function (d) {
          return "translate(" + d.x + "," + d.y + ")";
        });

      node.append("title")
        .text(function (d) {
          return d.Name + ": " + (d.Gold + d.Silver + d.Bronze);
        });

      node.append("circle")
        .attr("r", function (d) {
          return d.r;
        })
        .style("fill", function (d, i) {
          return color(i);
        });

      node.append("text")
        .attr("dy", ".2em")
        .style("text-anchor", "middle")
        .text(function (d) {
          return d.data.Name.substring(0, d.r / 3);
        })
        .attr("font-family", "sans-serif")
        .attr("font-size", function (d) {
          return d.r / 5;
        })
        .attr("fill", "white");

      node.append("text")
        .attr("dy", "1.3em")
        .style("text-anchor", "middle")
        .text(function (d) {
          return (d.data.Gold + d.data.Silver + d.data.Bronze);
        })
        .attr("font-family", "Gill Sans", "Gill Sans MT")
        .attr("font-size", function (d) {
          return d.r / 5;
        })
        .attr("fill", "white");

      d3.select(self.frameElement)
        .style("height", diameter + "px");
    }

    prepData(2016);

  </script>
</body>

</html>
